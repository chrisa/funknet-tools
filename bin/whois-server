#!/usr/bin/perl
use strict;
use Getopt::Std;
use Funknet::Whois::Server;
use Funknet::ConfigFile::Whois;

use vars qw/ $s /;

my %opt;
getopts('f:', \%opt);

unless ($opt{f}) {
    print STDERR "usage: $0 -f whois_server_config_file -s whois_source -d data_file\n";
    exit(1);
}
unless (-f $opt{f}) {
    print STDERR "-f option requires a path to a readable funknet.conf file\n";
    exit(1);
}

my $config = new Funknet::ConfigFile::Whois($opt{f});

$s = new Funknet::Whois::Server($config->whois_source, $config->objects_file, 1);
my $num = $s->load();

$SIG{HUP} = \&main::reload;
sub reload {
    $Funknet::Whois::Server::reload = 1;
    $SIG{HUP} = \&main::reload;
}	

$s->start($config->listen_address(), $config->listen_port());
$s->go();

